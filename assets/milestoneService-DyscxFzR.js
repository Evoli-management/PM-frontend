import{c as r}from"./index-CFjwWMQb.js";const i=(n,e)=>{if(console.error(`Error ${n}:`,e),e.response&&e.response.data&&e.response.data.message){const s=Array.isArray(e.response.data.message)?e.response.data.message.join(", "):e.response.data.message;throw console.error("Backend validation errors:",s),new Error(`Failed to ${n}. ${s}`)}throw new Error(`Failed to ${n}. ${e.message||"Please try again."}`)},d=async(n,e)=>{try{const s={title:e.title,weight:parseFloat(e.weight)||1};if(e.dueDate){const a=new Date(e.dueDate);isNaN(a)||(s.dueDate=a.toISOString().slice(0,10))}if(e.startDate){const a=new Date(e.startDate);isNaN(a)||(s.startDate=a.toISOString().slice(0,10))}const t={goalId:n,...s};return console.log("Creating milestone with data:",t),(await r.post("/milestones",t)).data}catch(s){i("creating milestone",s)}},l=async(n,e)=>{var s;try{const t={};if(e.title!==void 0&&(t.title=e.title),e.weight!==void 0&&(t.weight=parseFloat(e.weight)||1),e.score!==void 0){const o=parseFloat(e.score);t.score=isNaN(o)?null:o}if(e.dueDate!==void 0)if(e.dueDate){const o=new Date(e.dueDate);t.dueDate=isNaN(o)?null:o.toISOString().slice(0,10)}else t.dueDate=null;if(e.startDate!==void 0)if(e.startDate){const o=new Date(e.startDate);t.startDate=isNaN(o)?null:o.toISOString().slice(0,10)}else t.startDate=null;if(e.done!==void 0)try{return console.log("Trying PATCH for milestone done status"),(await r.patch(`/milestones/${n}`,{done:e.done})).data}catch(o){console.log("PATCH failed, falling back to PUT:",o),t.done=e.done}console.log("Updating milestone with data:",t);try{return(await r.put(`/milestones/${n}`,t)).data}catch(o){if(((s=o.response)==null?void 0:s.status)===404)return console.log("PUT not supported, trying PATCH"),(await r.patch(`/milestones/${n}`,t)).data;throw o}}catch(t){i("updating milestone",t)}},g=async(n,e)=>{var s;try{console.log(`Marking milestone ${n} as ${e?"done":"not done"}`);try{return(await r.patch(`/milestones/${n}/${e?"complete":"uncomplete"}`)).data}catch(t){if(((s=t.response)==null?void 0:s.status)===404)return console.log("Toggle endpoint not found, using regular update"),await l(n,{done:e});throw t}}catch(t){i(`marking milestone as ${e?"done":"not done"}`,t)}},p=async n=>{var e;try{console.log("Deleting milestone:",n);try{return await r.delete(`/milestones/${n}`),!0}catch(s){if(((e=s.response)==null?void 0:e.status)===404)return console.log("DELETE not supported, trying to mark as deleted"),await r.patch(`/milestones/${n}`,{deleted:!0}),!0;throw s}}catch(s){i("deleting milestone",s)}};export{d as createMilestone,p as deleteMilestone,g as toggleMilestoneDone,l as updateMilestone};
