const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/activityService-BlPQdQSK.js","assets/index-DJ9WloyM.js","assets/index-CH3sAiQw.css","assets/keyAreaService-DTC_lA_G.js","assets/taskService-CIKvHjYt.js","assets/goalService-hw7rqR8y.js"])))=>i.map(i=>d[i]);
import{u as se,r as d,R as Y,j as e,_ as S}from"./index-DJ9WloyM.js";import{M as ae}from"./Modal-DlujafaJ.js";let N=null;const J=async()=>{if(N)return N;const r=await S(()=>import("./activityService-BlPQdQSK.js"),__vite__mapDeps([0,1,2]));return N=(r==null?void 0:r.default)||r,N};let w=null;const le=async()=>{if(w)return w;const r=await S(()=>import("./keyAreaService-DTC_lA_G.js"),__vite__mapDeps([3,1,2]));return w=(r==null?void 0:r.default)||r,w};let A=null;const Q=async()=>{if(A)return A;const r=await S(()=>import("./taskService-CIKvHjYt.js"),__vite__mapDeps([4,1,2]));return A=(r==null?void 0:r.default)||r,A},ne=({isOpen:r,onClose:p,onSave:C,initialData:o={},attachedTaskId:x=null,activityId:K=null,dayTaskIds:h=[],readOnly:a=!1})=>{var B,W,q;const{addToast:f}=se(),[M,g]=d.useState(!1),[_,I]=d.useState([]),[V,T]=d.useState([]),[m,E]=d.useState([]),[X,D]=d.useState([]),[j,L]=d.useState({}),[G,H]=d.useState(!1),b=!!K,[s,z]=d.useState({taskId:o.taskId||x||"",text:o.text||"",title:o.title||"",description:o.description||"",start_date:o.start_date||"",end_date:o.end_date||"",deadline:o.deadline||"",duration:o.duration||"",list_index:o.list_index||1,key_area_id:o.key_area_id||"",assignee:o.assignee||"",priority:o.priority||"normal",goal:o.goal||""}),P=d.useRef(null),R=d.useRef(null),F=d.useRef(null),v=t=>{const l=t==null?void 0:t.current;if(l){try{if(typeof l.showPicker=="function"){l.showPicker();return}}catch{}l.focus();try{l.click()}catch{}}},c=t=>{const{name:l,value:n}=t.target;z(i=>{const u={...i,[l]:l==="list_index"?parseInt(n,10):n};return l==="start_date"&&(!i.end_date||i.end_date<n)&&(u.end_date=n),u})};d.useEffect(()=>{let t=!1;async function l(){try{console.log("Fetching goals and other data for activity modal...");const n=await le(),i=await Q(),[u,y,U]=await Promise.all([n.list({includeTaskCount:!1}),S(()=>import("./goalService-hw7rqR8y.js"),__vite__mapDeps([5,1,2])).then(te=>te.getGoals()).catch(()=>[]),i.list({})]);console.log("Goals fetched for activity modal:",y),t||(I(Array.isArray(u)?u:[]),T(Array.isArray(y)?y:[]),D(Array.isArray(U)?U:[]))}catch(n){console.error("Failed to load data:",n),t||(I([]),T([]),D([]))}}return r&&l(),()=>{t=!0}},[r]),d.useEffect(()=>{if(!s.key_area_id){L({});return}const t=_.find(l=>l.id===s.key_area_id);t!=null&&t.listNames?L(t.listNames):L({})},[s.key_area_id,_]);const Z=(()=>{if(!s.key_area_id)return[1];const t=Object.keys(j||{}).map(Number).filter(i=>j[i]&&j[i].trim()!==""),l=X.filter(i=>i.keyAreaId===s.key_area_id&&i.list_index).map(i=>i.list_index).filter((i,u,y)=>y.indexOf(i)===u),n=[1,...t,...l];return[...new Set(n)].sort((i,u)=>i-u)})();d.useEffect(()=>{let t=!1;async function l(){const n=s.key_area_id;if(!r||x||!n){t||E([]);return}try{H(!0);const u=await(await Q()).list({keyAreaId:n});t||E(Array.isArray(u)?u:[])}catch(i){console.error("Failed to load tasks for key area",n,i),t||E([])}finally{t||H(!1)}}return l(),()=>{t=!0}},[r,s.key_area_id,x]);const O=Y.useMemo(()=>{if(!Array.isArray(h)||h.length===0||!Array.isArray(m)||m.length===0)return!1;const t=new Set(h.map(String));return m.some(l=>t.has(String(l.id)))},[h,m]),k=Y.useMemo(()=>!Array.isArray(h)||h.length===0,[h]),$=!!s.taskId||!!x,ee=async t=>{t.preventDefault();try{if(g(!0),!b&&k){f({title:"No tasks on this day",description:"Please schedule a task first or pick a different day.",variant:"warning"}),g(!1);return}if(!x&&!b){if(!s.key_area_id){f({title:"Please select a Key Area",variant:"error"}),g(!1);return}if(!s.taskId){f({title:"Please select a Task",description:"Pick a task in the selected Key Area to attach this activity.",variant:"error"}),g(!1);return}}const l={text:s.title&&s.title.trim()||s.text&&s.text.trim()||s.description&&s.description.trim()||"",taskId:x||s.taskId||null};if(!l.text){f({title:"Activity name is required",variant:"error"}),g(!1);return}let n;b?(n=await(await J()).update(K,l),f({title:"Activity updated",variant:"success"})):(n=await(await J()).create(l),f({title:"Activity created",variant:"success"})),C==null||C(n),p==null||p()}catch(l){console.error(`Failed to ${b?"update":"create"} activity`,l),f({title:`Failed to ${b?"update":"create"} activity`,description:String((l==null?void 0:l.message)||l),variant:"error"})}finally{g(!1)}};return r?e.jsx(ae,{open:r,onClose:p,children:e.jsxs("div",{className:"relative bg-white border border-slate-300 rounded-xl shadow-2xl w-[95vw] max-w-4xl overflow-hidden",children:[e.jsx("div",{className:"bg-white text-slate-900 border-b border-slate-200 py-3 px-4 text-center font-semibold",children:a?"View Activity":b?"Edit Activity":"Add Activity"}),e.jsxs("form",{className:"p-4 md:p-6",onSubmit:ee,children:[(s.taskId||x)&&e.jsx("input",{type:"hidden",name:"taskId",value:s.taskId||x}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"sr-only",htmlFor:"ka-activity-title",children:"Activity name"}),e.jsx("input",{id:"ka-activity-title",required:!a,className:"w-full rounded-md border border-slate-300 px-3 py-2 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-50 disabled:text-slate-700",placeholder:"Activity name",value:s.title,name:"title",onChange:c,readOnly:a,disabled:a})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"grid gap-3 content-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Description"}),e.jsx("input",{className:"mt-1 h-9 rounded-md border border-slate-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-50 disabled:text-slate-700",placeholder:"Brief description",value:s.description,name:"description",onChange:c,readOnly:a,disabled:a})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Start date"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{className:"h-9 w-full rounded-md border border-slate-300 pr-10 pl-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 hide-native-date-icon disabled:bg-slate-50 disabled:text-slate-700",type:"date",value:s.start_date,name:"start_date",onChange:c,ref:P,readOnly:a,disabled:a}),!a&&e.jsx("span",{role:"button",tabIndex:0,"aria-label":"Open date picker",className:"absolute inset-y-0 right-2 grid place-items-center text-base cursor-pointer select-none",onClick:()=>v(P),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&v(P)},children:"ðŸ“…"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"End date"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{className:"h-9 w-full rounded-md border border-slate-300 pr-10 pl-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 hide-native-date-icon disabled:bg-slate-50 disabled:text-slate-700",type:"date",value:s.end_date,name:"end_date",onChange:c,ref:R,readOnly:a,disabled:a}),!a&&e.jsx("span",{role:"button",tabIndex:0,"aria-label":"Open date picker",className:"absolute inset-y-0 right-2 grid place-items-center text-base cursor-pointer select-none",onClick:()=>v(R),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&v(R)},children:"ðŸ“…"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Deadline"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{className:"h-9 w-full rounded-md border border-slate-300 pr-10 pl-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 hide-native-date-icon disabled:bg-slate-50 disabled:text-slate-700",type:"date",value:s.deadline,name:"deadline",onChange:c,ref:F,readOnly:a,disabled:a}),!a&&e.jsx("span",{role:"button",tabIndex:0,"aria-label":"Open date picker",className:"absolute inset-y-0 right-2 grid place-items-center text-base cursor-pointer select-none",onClick:()=>v(F),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&v(F)},children:"ðŸ“…"})]}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"No later than"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Duration"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{className:"h-9 w-full rounded-md border border-slate-300 pr-10 pl-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-50 disabled:text-slate-700",placeholder:"e.g., 1h, 1d",value:s.duration,name:"duration",onChange:c,readOnly:a,disabled:a}),!a&&e.jsx("span",{className:"absolute inset-y-0 right-2 grid place-items-center text-base",children:"ðŸ“…"})]})]})]}),e.jsxs("div",{className:"grid gap-3 content-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Key Area"}),a?e.jsx("input",{className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-slate-50 text-slate-700",value:((B=_.find(t=>t.id===s.key_area_id))==null?void 0:B.title)||"â€”",readOnly:!0,disabled:!0}):e.jsxs("select",{name:"key_area_id",className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-50 disabled:text-slate-700",value:s.key_area_id,onChange:t=>{c(t),z(l=>({...l,taskId:""}))},disabled:!!x,children:[e.jsx("option",{value:"",children:"â€” Select key area â€”"}),_.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"List"}),a?e.jsx("input",{className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-slate-50 text-slate-700",value:j[s.list_index]||`List ${s.list_index}`||"â€”",readOnly:!0,disabled:!0}):e.jsx("select",{name:"list_index",className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-50 disabled:text-slate-700",value:s.list_index,onChange:c,disabled:!s.key_area_id,children:Z.map(t=>e.jsx("option",{value:t,children:j[t]||`List ${t}`},t))})]}),!x&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Task"}),a?e.jsx("input",{className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-slate-50 text-slate-700",value:((W=m.find(t=>t.id===s.taskId))==null?void 0:W.title)||"â€”",readOnly:!0,disabled:!0}):e.jsx("select",{name:"taskId",className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-50 disabled:text-slate-700",value:s.taskId,onChange:c,disabled:!s.key_area_id||G,children:s.key_area_id?G?e.jsx("option",{value:"",children:"Loading tasksâ€¦"}):m.length===0?e.jsx("option",{value:"",children:"No tasks found in this key area"}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"â€” Select task â€”"}),m.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]}):e.jsx("option",{value:"",children:"Select key area first"})}),!a&&s.key_area_id&&m.length>0&&!O&&e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"No tasks on this day in the selected Key Area. You can still pick any task."}),!a&&s.key_area_id&&m.length>0&&!s.taskId&&e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Please select a task to attach the activity."})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Respons."}),a?e.jsx("input",{className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-slate-50 text-slate-700",value:s.assignee||"â€” Unassigned â€”",readOnly:!0,disabled:!0}):e.jsxs("select",{name:"assignee",className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-50 disabled:text-slate-700",value:s.assignee,onChange:c,children:[e.jsx("option",{value:"",children:"â€” Unassigned â€”"}),e.jsx("option",{value:"Me",children:"Me"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Priority"}),a?e.jsx("input",{className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-slate-50 text-slate-700",value:s.priority==="high"?"High":s.priority==="low"?"Low":"Normal",readOnly:!0,disabled:!0}):e.jsxs("select",{name:"priority",className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-50 disabled:text-slate-700",value:s.priority,onChange:c,children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Goal"}),a?e.jsx("input",{className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-50 disabled:text-slate-700",value:((q=V.find(t=>t.id===s.goal))==null?void 0:q.title)||"â€”",disabled:!0}):e.jsxs("select",{className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:s.goal||"",name:"goal",onChange:c,children:[e.jsx("option",{value:"",children:"â€” Select Goal â€”"}),V.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[12px] text-slate-500",children:[!a&&!b&&k&&e.jsx(e.Fragment,{children:"No tasks exist on this day. Please schedule a task first."}),!a&&!b&&!k&&!$&&e.jsx(e.Fragment,{children:"Select a task to enable the OK button."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a&&e.jsxs("button",{type:"submit",className:"rounded-md bg-blue-600 hover:bg-blue-700 text-white font-semibold flex items-center gap-2 px-4 py-2 text-sm disabled:opacity-60 disabled:cursor-not-allowed",disabled:M||!b&&(k||!$),children:[e.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 448 512",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"})}),M?"Savingâ€¦":"OK"]}),e.jsx("button",{type:"button",className:"rounded-md border border-slate-300 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50",onClick:p,children:a?"Close":"Cancel"}),!a&&e.jsx("button",{type:"button",className:"rounded-md border border-slate-300 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50",disabled:!0,children:"Help"})]})]})]}),e.jsx("button",{type:"button",className:"absolute top-2 right-2 p-2 rounded-md text-slate-600 hover:text-slate-800 hover:bg-slate-100","aria-label":"Close",onClick:p,children:e.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 352 512",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})})})]})}):null};export{ne as default};
