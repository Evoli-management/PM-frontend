import{b as g,u as k,r as d,o as $,j as e,F as w,c as D}from"./index-CAHFno4u.js";const x="/tasks",U={async delegateTask(a,l){return(await g.post(`${x}/${a}/delegate`,l)).data},async getDelegationHistory(a){return(await g.get(`${x}/${a}/delegation-history`)).data},async getDelegatedToMe(){return(await g.get(`${x}/delegated-to-me`)).data},async revokeDelegation(a){return(await g.delete(`${x}/${a}/delegation`)).data}};function I({isOpen:a,onClose:l,task:s,onDelegated:m}){var v,N;const{addToast:o}=k?k():{addToast:()=>{}},[b,T]=d.useState([]),[i,y]=d.useState(""),[h,f]=d.useState(""),[u,j]=d.useState(!1),[F,p]=d.useState(!1);d.useEffect(()=>{a&&(S(),y(""),f(""))},[a]);const S=async()=>{p(!0);try{const t=await $.getOrganizationMembers();T(t||[])}catch(t){console.error("Failed to load members:",t),o({title:"Failed to load team members",variant:"error"})}finally{p(!1)}},M=async()=>{var t,n;if(!i){o({title:"Please select a team member",variant:"warning"});return}j(!0);try{const c=await U.delegateTask(s.id,{delegatedToUserId:i,notes:h.trim()||void 0});o({title:"Task delegated successfully",variant:"success"}),m==null||m(c),l()}catch(c){console.error("Failed to delegate task:",c),o({title:((n=(t=c.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to delegate task",variant:"error"})}finally{j(!1)}};if(!a)return null;const r=b.find(t=>(t.userId||t.id)===i);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Delegate Task"})]}),e.jsx("button",{onClick:l,className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:e.jsx(D,{})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:(s==null?void 0:s.title)||"Task"}),(s==null?void 0:s.description)&&e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:s.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Delegate to:"}),F?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading team members..."}):e.jsxs("select",{value:i,onChange:t=>y(t.target.value),className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                                         bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                                         focus:ring-2 focus:ring-blue-500 focus:border-blue-500`,children:[e.jsx("option",{value:"",children:"Select team member..."}),b.map(t=>{const n=t.userId||t.id;return e.jsxs("option",{value:n,children:[t.firstName," ",t.lastName," (",t.email,")",t.role&&` - ${t.role}`]},n)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (optional):"}),e.jsx("textarea",{value:h,onChange:t=>f(t.target.value),placeholder:"Add any context or instructions...",rows:3,className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                                     bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                                     focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                                     resize-none`})]}),r&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Delegating to:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.avatarUrl?e.jsx("img",{src:r.avatarUrl,alt:r.firstName,className:"w-8 h-8 rounded-full"}):e.jsxs("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white text-sm font-medium",children:[(v=r.firstName)==null?void 0:v[0],(N=r.lastName)==null?void 0:N[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[r.firstName," ",r.lastName]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:r.email})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:l,disabled:u,className:`px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300
                                 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg
                                 disabled:opacity-50 disabled:cursor-not-allowed`,children:"Cancel"}),e.jsx("button",{onClick:M,disabled:u||!i,className:`px-4 py-2 text-sm font-medium text-white bg-blue-600
                                 hover:bg-blue-700 rounded-lg
                                 disabled:opacity-50 disabled:cursor-not-allowed
                                 flex items-center gap-2`,children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Delegating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{}),"Delegate Task"]})})]})]})})}export{I as default};
