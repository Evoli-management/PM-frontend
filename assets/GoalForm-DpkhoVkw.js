import{r as l,u as B,a as Y,j as t,C as J,b as Q,P as X,T as Z}from"./index-Bw5N71gq.js";const se=({onClose:f,onGoalCreated:L,keyAreas:$=[],goal:s,isEditing:h=!1})=>{var P;const u=new Date().toISOString().split("T")[0],[n,w]=l.useState({title:(s==null?void 0:s.title)||"",description:(s==null?void 0:s.description)||"",priority:(s==null?void 0:s.priority)||"medium",tags:(s==null?void 0:s.tags)||[],startDate:s!=null&&s.startDate?new Date(s.startDate).toISOString().split("T")[0]:u,dueDate:s!=null&&s.dueDate?new Date(s.dueDate).toISOString().split("T")[0]:u,keyAreaId:(s==null?void 0:s.keyAreaId)||"",status:(s==null?void 0:s.status)||"active",visibility:(s==null?void 0:s.visibility)||"public"}),[d,x]=l.useState(((P=s==null?void 0:s.milestones)==null?void 0:P.length)>0?s.milestones.map(e=>({id:e.id,title:e.title,weight:e.weight||1,startDate:e.startDate?new Date(e.startDate).toISOString().split("T")[0]:"",dueDate:e.dueDate?new Date(e.dueDate).toISOString().split("T")[0]:""})):[{title:"",weight:1,startDate:u,dueDate:u}]);l.useEffect(()=>{var e;s&&(w({title:(s==null?void 0:s.title)||"",description:(s==null?void 0:s.description)||"",priority:(s==null?void 0:s.priority)||"medium",tags:(s==null?void 0:s.tags)||[],startDate:s!=null&&s.startDate?new Date(s.startDate).toISOString().split("T")[0]:u,dueDate:s!=null&&s.dueDate?new Date(s.dueDate).toISOString().split("T")[0]:u,keyAreaId:(s==null?void 0:s.keyAreaId)||"",status:(s==null?void 0:s.status)||"active",visibility:(s==null?void 0:s.visibility)||"public"}),x(((e=s==null?void 0:s.milestones)==null?void 0:e.length)>0?s.milestones.map(r=>({id:r.id,title:r.title,weight:r.weight||1,startDate:r.startDate?new Date(r.startDate).toISOString().split("T")[0]:"",dueDate:r.dueDate?new Date(r.dueDate).toISOString().split("T")[0]:""})):[{title:"",weight:1,startDate:u,dueDate:u}]),b(0),y.current=s!=null&&s.startDate?new Date(s.startDate).toISOString().split("T")[0]:u)},[s]);const[i,b]=l.useState(0),[z,T]=l.useState(!1),[o,D]=l.useState({}),y=l.useRef(n.startDate),j=l.useRef(null),N=l.useRef(null),k=l.useRef(null),{position:O,isDragging:S,handleMouseDown:F,handleMouseMove:C,handleMouseUp:I,resetPosition:_}=B(),{size:R,isDraggingResize:H,handleResizeMouseDown:M}=Y(600,560),A=l.useRef(null);l.useEffect(()=>{if(S)return document.addEventListener("mousemove",C),document.addEventListener("mouseup",I),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",I)}},[S,C,I]),l.useEffect(()=>{f&&_()},[_]);const m=(e,r)=>{w(a=>({...a,[e]:r})),o[e]&&D(a=>({...a,[e]:null}))};l.useEffect(()=>{if(h){y.current=n.startDate;return}const e=y.current,r=n.startDate;w(a=>!a.dueDate||a.dueDate===e?{...a,dueDate:r}:a),x(a=>a.map(p=>{const c={...p};return(!c.startDate||c.startDate===e)&&(c.startDate=r),(!c.dueDate||c.dueDate===e)&&(c.dueDate=r),c})),y.current=r},[n.startDate,h]);const v=(e,r)=>{var E;const a=[...d],p=(E=a[i])==null?void 0:E.startDate,c={...a[i],[e]:r};e==="startDate"&&(!a[i].dueDate||a[i].dueDate===p)&&(c.dueDate=r),a[i]=c,x(a)},U=()=>{if(d.length>=10)return;const e=[...d,{title:"",weight:1,startDate:"",dueDate:""}];x(e),b(e.length-1)},W=()=>{if(d.length===1)return;const e=d.filter((a,p)=>p!==i);let r=i;r>=e.length&&(r=e.length-1),x(e),b(r)},q=()=>{i!==0&&b(e=>e-1)},G=()=>{i>=d.length-1||b(e=>e+1)},V=()=>{const e={};if(n.title.trim()?n.title.length<3?e.title="Title must be at least 3 characters":n.title.length>200&&(e.title="Title must be less than 200 characters (current: "+n.title.length+")"):e.title="Title is required",!n.dueDate)e.dueDate="Deadline is required";else{const r=new Date(n.dueDate),a=new Date;a.setHours(0,0,0,0),r<a&&!h&&(e.dueDate="Deadline must be today or in the future")}if(n.startDate&&n.dueDate){const r=new Date(n.startDate),a=new Date(n.dueDate);r>a&&(e.startDate="Start date must be before or equal to due date")}return D(e),Object.keys(e).length===0},K=async()=>{if(!V())return;T(!0);const e={title:n.title.trim(),description:n.description?n.description.trim():null,startDate:n.startDate||null,dueDate:n.dueDate,keyAreaId:n.keyAreaId||null,visibility:n.visibility,status:n.status,milestones:d.filter(r=>r.title.trim()).map(r=>({...r.id&&{id:r.id},title:r.title.trim(),weight:parseFloat(r.weight)||1,startDate:r.startDate||null,dueDate:r.dueDate||null}))};try{await L(e),f()}catch(r){D({general:r.message||"Failed to save goal. Please try again."})}finally{T(!1)}},g=d[i]||{title:"",weight:1,startDate:"",dueDate:""};return t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-fadeIn",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:[t.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from { 
            opacity: 0;
            transform: translateY(20px);
          }
          to { 
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.2s ease-out;
        }
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }
        /* Hide native inline date-picker indicator for inputs using .no-calendar
           Keep the separate ðŸ“… button visible and functional. */
        input.no-calendar::-webkit-calendar-picker-indicator {
          opacity: 0;
          pointer-events: none;
          display: block;
          width: 0;
          height: 0;
        }
        /* Also hide clear/spinner controls in WebKit browsers */
        input.no-calendar::-webkit-clear-button,
        input.no-calendar::-webkit-inner-spin-button {
          display: none;
        }
        /* Ensure appearance none for consistent look */
        input.no-calendar { -webkit-appearance: none; appearance: none; }
        /* Firefox - hide calendar picker appearance */
        input.no-calendar::-moz-focus-inner { border: 0; }
      `}),t.jsxs("div",{className:"relative bg-white rounded-xl shadow-2xl flex flex-col animate-slideUp overflow-hidden border border-gray-200",onClick:e=>e.stopPropagation(),style:{transform:`translate(${O.x}px, ${O.y}px)`,cursor:S?"grabbing":H?"se-resize":"default",width:`${R.width}px`,height:`${R.height}px`,minWidth:"300px",minHeight:"200px"},children:[t.jsxs("div",{className:"relative flex items-center justify-between px-6 py-4 border-b border-gray-200 cursor-grab active:cursor-grabbing select-none flex-shrink-0",onMouseDown:F,children:[t.jsx("div",{className:"w-10","aria-hidden":"true"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900 absolute left-1/2 transform -translate-x-1/2",children:h?"Edit Goal":"Add Goal"}),t.jsx("button",{type:"button",onClick:f,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200","aria-label":"Close",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-x w-5 h-5","aria-hidden":"true",children:[t.jsx("path",{d:"M18 6 6 18"}),t.jsx("path",{d:"m6 6 12 12"})]})})]}),t.jsxs("div",{className:"px-6 py-4 overflow-y-auto flex-1",children:[o.general&&t.jsxs("div",{className:"mb-4 p-3 bg-red-50 border-l-4 border-red-500 rounded-r text-red-700 text-sm",children:[t.jsx("strong",{className:"font-medium",children:"Error:"})," ",o.general]}),t.jsxs("div",{className:"mb-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Goal name ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("span",{className:`text-xs font-medium ${n.title.length>150?"text-red-600":n.title.length>100?"text-yellow-600":"text-gray-400"}`,children:[n.title.length,"/200"]})]}),t.jsx("input",{type:"text",maxLength:"200",value:n.title,onChange:e=>m("title",e.target.value),className:`w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-50 mt-0.5 ${o.title?"border-red-300 bg-red-50":""}`,placeholder:"Enter goal name (max 200 characters)"}),n.title.length>150&&!o.title&&t.jsx("p",{className:"text-yellow-700 text-xs mt-1",children:"âš ï¸ Long names may be truncated in some views"}),o.title&&t.jsx("p",{className:"text-red-600 text-xs mt-1",children:o.title})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_auto_1fr] gap-y-4 md:gap-x-6",children:[t.jsxs("div",{className:"grid gap-3 content-start md:col-span-1",children:[t.jsxs("div",{className:"min-h-[72px]",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Description"}),t.jsx("input",{type:"text",value:n.description,onChange:e=>m("description",e.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-green-500 focus:ring-2 focus:ring-green-50 mt-0",placeholder:"Add a short description (optional)"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Start date"}),t.jsxs("div",{className:"relative mt-0",children:[t.jsx("input",{name:"start_date",ref:j,type:"date",value:n.startDate,onChange:e=>m("startDate",e.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-green-500 focus:ring-2 focus:ring-green-50 appearance-none pr-11 no-calendar"}),t.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-purple-600","aria-label":"Open date picker",onClick:()=>{var e,r,a;try{(r=(e=j.current)==null?void 0:e.showPicker)==null||r.call(e),(a=j.current)==null||a.focus()}catch{}},children:"ðŸ“…"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Deadline ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative mt-0",children:[t.jsx("input",{name:"due_date",required:!0,ref:N,type:"date",value:n.dueDate,onChange:e=>m("dueDate",e.target.value),className:`w-full rounded-lg border px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-green-500 focus:ring-2 focus:ring-green-50 appearance-none pr-11 no-calendar ${o.dueDate?"border-red-300 bg-red-50":"border-slate-300 bg-white"}`,min:new Date().toISOString().split("T")[0]}),t.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-purple-600","aria-label":"Open date picker",onClick:()=>{var e,r,a;try{(r=(e=N.current)==null?void 0:e.showPicker)==null||r.call(e),(a=N.current)==null||a.focus()}catch{}},children:"ðŸ“…"})]}),o.dueDate&&t.jsx("p",{className:"text-red-600 text-xs mt-0",children:o.dueDate})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Key Area"}),t.jsxs("select",{value:n.keyAreaId,onChange:e=>m("keyAreaId",e.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-green-500 focus:ring-2 focus:ring-green-50 appearance-none pr-10 mt-0",children:[t.jsx("option",{value:"",children:"Select key area"}),$.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Visibility"}),t.jsxs("select",{value:n.visibility,onChange:e=>m("visibility",e.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-green-500 focus:ring-2 focus:ring-green-50 appearance-none pr-10 mt-0",children:[t.jsx("option",{value:"public",children:"Public"}),t.jsx("option",{value:"private",children:"Private"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Priority"}),t.jsxs("select",{value:n.priority,onChange:e=>m("priority",e.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-green-500 focus:ring-2 focus:ring-green-50 appearance-none pr-10 mt-0",children:[t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Tags (comma-separated)"}),t.jsx("input",{type:"text",value:Array.isArray(n.tags)?n.tags.join(", "):"",onChange:e=>{const r=e.target.value.split(",").map(a=>a.trim()).filter(a=>a);m("tags",r)},className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-green-500 focus:ring-2 focus:ring-green-50 mt-0",placeholder:"e.g., important, urgent"})]})]}),t.jsx("div",{className:"hidden md:flex md:items-stretch md:justify-center md:col-span-1",children:t.jsx("div",{className:"w-px bg-slate-200 my-2"})}),t.jsxs("div",{className:"grid gap-3 content-start md:col-span-1",children:[t.jsxs("div",{className:"flex items-center justify-between min-h-[72px]",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:q,disabled:i===0,className:"p-1 rounded-md border border-gray-300 text-gray-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(J,{className:"w-3 h-3"})}),t.jsxs("span",{className:"text-sm font-medium text-gray-800",children:["Milestones (",i+1,"/",d.length,")"]}),t.jsx("button",{type:"button",onClick:G,disabled:i>=d.length-1,className:"p-1 rounded-md border border-gray-300 text-gray-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:t.jsx(Q,{className:"w-3 h-3"})})]}),t.jsxs("button",{type:"button",onClick:U,disabled:d.length>=10,className:"flex items-center gap-1 text-xs font-medium text-blue-600 hover:text-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx(X,{className:"w-3 h-3"}),"Add"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Name of milestone"}),t.jsx("input",{type:"text",value:g.title,onChange:e=>v("title",e.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-50 mt-0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Start date"}),t.jsxs("div",{className:"relative mt-0",children:[t.jsx("input",{name:"start_date",ref:k,type:"date",value:g.startDate,onChange:e=>v("startDate",e.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-50 appearance-none pr-11 no-calendar"}),t.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-purple-600","aria-label":"Open date picker",onClick:()=>{var e,r,a;try{(r=(e=k.current)==null?void 0:e.showPicker)==null||r.call(e),(a=k.current)==null||a.focus()}catch{}},children:"ðŸ“…"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Deadline"}),t.jsxs("div",{className:"relative mt-0",children:[t.jsx("input",{name:`milestone_due_${i}`,ref:A,type:"date",value:g.dueDate,onChange:e=>v("dueDate",e.target.value),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-50 appearance-none pr-11 no-calendar"}),t.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-purple-600","aria-label":"Open date picker",onClick:()=>{var e,r,a;try{(r=(e=A.current)==null?void 0:e.showPicker)==null||r.call(e),(a=A.current)==null||a.focus()}catch{}},children:"ðŸ“…"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Weight"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"number",min:"0.1",step:"0.1",value:g.weight,onChange:e=>v("weight",e.target.value===""?"":parseFloat(e.target.value)),className:"flex-1 rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-900 shadow-sm placeholder-slate-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-50 mt-0"}),t.jsx("button",{type:"button",onClick:W,disabled:d.length===1,className:"text-red-600 disabled:opacity-50 disabled:cursor-not-allowed hover:text-red-700","aria-label":"Delete milestone",children:t.jsx(Z,{className:"w-4 h-4"})})]})]})]})]})]}),t.jsx("div",{className:"flex justify-end gap-3 px-6 py-4",children:t.jsxs("div",{className:"flex items-center justify-end gap-2 w-full",children:[t.jsxs("button",{type:"submit",onClick:K,disabled:z,className:"rounded-md bg-blue-600 hover:bg-blue-700 text-white font-semibold flex items-center gap-2 px-4 py-2 text-sm",children:[t.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 448 512",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"})}),z?"Saving...":h?"Update":"Save"]}),t.jsx("button",{type:"button",onClick:f,className:"rounded-md border border-slate-300 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50",children:"Cancel"}),t.jsx("button",{type:"button",className:"rounded-md border border-slate-300 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50",disabled:!0,children:"Help"})]})}),t.jsx("div",{onMouseDown:e=>M(e,"right"),className:"absolute top-0 right-0 w-1 h-full cursor-e-resize hover:bg-blue-500/20 transition-colors",style:{zIndex:40}}),t.jsx("div",{onMouseDown:e=>M(e,"bottom"),className:"absolute bottom-0 left-0 w-full h-1 cursor-s-resize hover:bg-blue-500/20 transition-colors",style:{zIndex:40}}),t.jsx("div",{onMouseDown:e=>M(e,"se"),className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize hover:bg-blue-500/30 transition-colors rounded-tl",style:{zIndex:41},title:"Drag to resize"})]})]})};export{se as default};
