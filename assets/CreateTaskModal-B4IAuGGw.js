const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D5FElGeg.js","assets/index-DT84ew3j.css","assets/goalService-BAIwQhXK.js"])))=>i.map(i=>d[i]);
import{u as M,r as d,_ as I,j as e,M as G}from"./index-D5FElGeg.js";let p=null;const K=async()=>{if(p)return p;const n=await I(()=>import("./index-D5FElGeg.js").then(u=>u.k),__vite__mapDeps([0,1]));return p=(n==null?void 0:n.default)||n,p};let g=null;const D=async()=>{if(g)return g;const n=await I(()=>import("./index-D5FElGeg.js").then(u=>u.t),__vite__mapDeps([0,1]));return g=(n==null?void 0:n.default)||n,g};function H({isOpen:n,onClose:u,onSave:y,initialData:i={},preselectedKeyArea:v=null,renderInline:$=!1,taskId:A=null}){const{addToast:m}=M(),[j,S]=d.useState([]),[L,T]=d.useState([]),[O,C]=d.useState([]),[f,k]=d.useState({}),[V,E]=d.useState(!1),b=!!A,[s,R]=d.useState({keyAreaId:v||i.keyAreaId||"",title:i.title||"",description:i.description||"",date:i.date||new Date().toISOString().split("T")[0],time:i.time||"09:00",dueDate:i.dueDate||"",endDate:i.endDate||"",list_index:i.list_index||1,priority:i.priority||"medium",assignee:i.assignee||"",status:i.status||"todo",duration:i.duration||"",goal:i.goal||""}),N=d.useRef(null),w=d.useRef(null),_=d.useRef(null),x=t=>{const l=t==null?void 0:t.current;if(l){try{if(typeof l.showPicker=="function"){l.showPicker();return}}catch{}l.focus();try{l.click()}catch{}}};d.useEffect(()=>{n&&(async()=>{try{console.log("Fetching goals and other data...");const t=await K(),l=await D(),[r,a,o]=await Promise.all([t.list({includeTaskCount:!1}),I(()=>import("./goalService-BAIwQhXK.js"),__vite__mapDeps([2,0,1])).then(h=>h.getGoals()).catch(()=>[]),l.list({})]);console.log("Goals fetched:",a),S(Array.isArray(r)?r:[]),T(Array.isArray(a)?a:[]),C(Array.isArray(o)?o:[])}catch(t){console.error("Failed to load data:",t),S([]),T([]),C([])}})()},[n]),d.useEffect(()=>{if(!s.keyAreaId){k({});return}const t=j.find(l=>l.id===s.keyAreaId);t!=null&&t.listNames?k(t.listNames):k({})},[s.keyAreaId,j]);const P=(()=>{if(!s.keyAreaId)return[1];const t=Object.keys(f||{}).map(Number).filter(a=>f[a]&&f[a].trim()!==""),l=O.filter(a=>a.keyAreaId===s.keyAreaId&&a.list_index).map(a=>a.list_index).filter((a,o,h)=>h.indexOf(a)===o),r=[1,...t,...l];return[...new Set(r)].sort((a,o)=>a-o)})();d.useEffect(()=>{n||R({keyAreaId:v||"",title:"",description:"",date:new Date().toISOString().split("T")[0],time:"09:00",dueDate:"",endDate:"",list_index:1,priority:"medium",assignee:"",status:"todo",duration:"",goal:""})},[n,v]);const c=t=>{const{name:l,value:r}=t.target;R(a=>{const o={...a,[l]:l==="list_index"?parseInt(r,10):r};return l==="date"&&(!a.endDate||a.endDate<r)&&(o.endDate=r),o})},F=async t=>{var l,r;if(t.preventDefault(),!s.title.trim()){m({title:"Task title is required",variant:"error"});return}if(!s.keyAreaId){m({title:"Please select a key area",variant:"error"});return}E(!0);try{const a={keyAreaId:s.keyAreaId,title:s.title.trim(),description:s.description.trim()||null,assignee:s.assignee.trim()||null,startDate:s.date&&s.time?new Date(`${s.date}T${s.time}`).toISOString():s.date?new Date(s.date).toISOString():null,dueDate:s.dueDate?new Date(s.dueDate).toISOString():null,endDate:s.endDate?new Date(s.endDate).toISOString():null,list_index:s.list_index||1,status:s.status,priority:s.priority};let o;b?(o=await(await D()).update(A,a),m({title:"Task updated successfully",variant:"success"})):(o=await(await D()).create(a),m({title:"Task created successfully",variant:"success"})),y==null||y(o),u()}catch(a){console.error(`Failed to ${b?"update":"create"} task:`,a),m({title:((r=(l=a.response)==null?void 0:l.data)==null?void 0:r.message)||`Failed to ${b?"update":"create"} task`,variant:"error"})}finally{E(!1)}};return n?e.jsx(G,{open:n,onClose:u,children:e.jsxs("div",{className:"relative bg-white border border-slate-300 rounded-xl shadow-2xl w-[95vw] max-w-4xl overflow-hidden",children:[e.jsx("div",{className:"bg-white text-slate-900 border-b border-slate-200 py-3 px-4 text-center font-semibold",children:b?"Edit Task":"Add Task"}),e.jsxs("form",{className:"p-4 md:p-6",onSubmit:F,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"sr-only",htmlFor:"ka-task-title",children:"Task name"}),e.jsx("input",{autoFocus:!0,id:"ka-task-title",required:!0,className:"w-full rounded-md border border-slate-300 px-3 py-2 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Task name",value:s.title,name:"title",onChange:c})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"grid gap-3 content-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Description"}),e.jsx("input",{className:"mt-1 h-9 rounded-md border border-slate-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description",value:s.description,name:"description",onChange:c})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Start date"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{ref:N,className:"h-9 w-full rounded-md border border-slate-300 pr-10 pl-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 hide-native-date-icon",type:"date",value:s.date,name:"date",onChange:c}),e.jsx("span",{role:"button",tabIndex:0,"aria-label":"Open date picker",className:"absolute inset-y-0 right-2 grid place-items-center text-base cursor-pointer select-none",onClick:()=>x(N),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&x(N)},children:"ðŸ“…"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"End date"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{ref:w,className:"h-9 w-full rounded-md border border-slate-300 pr-10 pl-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 hide-native-date-icon",type:"date",value:s.endDate,name:"endDate",onChange:c}),e.jsx("span",{role:"button",tabIndex:0,"aria-label":"Open date picker",className:"absolute inset-y-0 right-2 grid place-items-center text-base cursor-pointer select-none",onClick:()=>x(w),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&x(w)},children:"ðŸ“…"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Deadline"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{ref:_,className:"h-9 w-full rounded-md border border-slate-300 pr-10 pl-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 hide-native-date-icon",type:"date",value:s.dueDate,name:"dueDate",onChange:c}),e.jsx("span",{role:"button",tabIndex:0,"aria-label":"Open date picker",className:"absolute inset-y-0 right-2 grid place-items-center text-base cursor-pointer select-none",onClick:()=>x(_),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&x(_)},children:"ðŸ“…"})]}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"No later than"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Duration"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{className:"h-9 w-full rounded-md border border-slate-300 pr-10 pl-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 1h, 1d",value:s.duration||"",name:"duration",onChange:c}),e.jsx("span",{className:"absolute inset-y-0 right-2 grid place-items-center text-base",children:"ðŸ“…"})]})]})]}),e.jsxs("div",{className:"grid gap-3 content-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Key Area"}),e.jsxs("select",{name:"keyAreaId",className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:s.keyAreaId,onChange:c,children:[e.jsx("option",{value:"",children:"â€” Select key area â€”"}),j.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"List"}),e.jsx("select",{name:"list_index",className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:s.list_index,onChange:c,disabled:!s.keyAreaId,children:P.map(t=>e.jsx("option",{value:t,children:f[t]||`List ${t}`},t))})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Respons."}),e.jsxs("select",{name:"assignee",className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:s.assignee,onChange:c,children:[e.jsx("option",{value:"",children:"â€” Unassigned â€”"}),e.jsx("option",{value:"Me",children:"Me"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Priority"}),e.jsxs("select",{name:"priority",className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:s.priority,onChange:c,children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Goal"}),e.jsxs("select",{className:"mt-1 h-10 rounded-md border border-slate-300 px-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:s.goal||"",name:"goal",onChange:c,children:[e.jsx("option",{value:"",children:"â€” Select Goal â€”"}),L.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsx("span",{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"submit",className:"rounded-md bg-blue-600 hover:bg-blue-700 text-white font-semibold flex items-center gap-2 px-4 py-2 text-sm",children:"OK"}),e.jsx("button",{type:"button",className:"rounded-md border border-slate-300 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50",onClick:u,children:"Cancel"}),e.jsx("button",{type:"button",className:"rounded-md border border-slate-300 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50",children:"Help"})]})]})]}),e.jsx("button",{type:"button",className:"absolute top-2 right-2 p-2 rounded-md text-slate-600 hover:text-slate-800 hover:bg-slate-100","aria-label":"Close",onClick:u,children:"âœ•"})]})}):null}export{H as default};
